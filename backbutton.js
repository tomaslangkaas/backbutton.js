var backbutton = function(b){function k(a){a=a||b[d][m]||"";var c=a.indexOf("#");return-1<c?a.slice(c+1):""}function n(a,c){(c||b[d]).hash="#"+a}function v(){var a=k(),c=k(e[d][m]);a!=l?(a!=c&&(g=e[p],g.open(),g.close(),n(a,e[d])),q(0,a),l=a):c!=l&&(b[d][m]=b[d][m].replace(/#.*/,"#")+c)}function q(a,c){var b,f=r.length;c=c||k();t&&t(c);for(b=0;b<f;b++)r[b](c)}var r=[],p="document",u=b[p],d="location",m="href",h="onhashchange"in b&&b.addEventListener,e,g,t,l=k(),w={observe:function(a){r.push(a)},navigate:n,current:k,routes:function(a,c){t=a?function(b){for(var f=0,d=a.length,e;f<d;f+=2)if(e=b.match(a[f])){a[f+1].apply(null,e.slice(1));break}f==d&&c&&c(b)}:0},refresh:q,back:function(){b.history.back()}};n(l);h?b.addEventListener("hashchange",q,!1):(h=u.createElement("iframe"),h.src="javascript:0",h.style.display="none",h.tabIndex=-1,e=u.body.insertBefore(h,u.body.firstChild).contentWindow,g=e[p],g.open(),g.close(),n(l,e[d]),setInterval(v,50));return w}(window);
